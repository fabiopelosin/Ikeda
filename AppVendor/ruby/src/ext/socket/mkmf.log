have_library: checking for t_open() in -lnsl... -------------------- no

"/usr/bin/gcc-4.2 -o conftest -I../../.ext/include/x86_64-darwin12.2.0 -I../.././include -I../.././ext/socket -I../.. -I../../. -D_XOPEN_SOURCE -D_DARWIN_C_SOURCE   -I/Users/fabio/.sm/pkg/active/include -pipe conftest.c  -L. -L../.. -L. -Bstatic -L/Users/fabio/.sm/pkg/active/lib -L/usr/local/lib     -lruby-static -lnsl  -lpthread -ldl -lobjc "
conftest.c: In function ‘t’:
conftest.c:6: error: ‘t_open’ undeclared (first use in this function)
conftest.c:6: error: (Each undeclared identifier is reported only once
conftest.c:6: error: for each function it appears in.)
checked program was:
/* begin */
1: #include "ruby.h"
2: 
3: /*top*/
4: int main() {return 0;}
5: extern int t(void);
6: int t(void) { void ((*volatile p)()); p = (void ((*)()))t_open; return 0; }
/* end */

"/usr/bin/gcc-4.2 -o conftest -I../../.ext/include/x86_64-darwin12.2.0 -I../.././include -I../.././ext/socket -I../.. -I../../. -D_XOPEN_SOURCE -D_DARWIN_C_SOURCE   -I/Users/fabio/.sm/pkg/active/include -pipe conftest.c  -L. -L../.. -L. -Bstatic -L/Users/fabio/.sm/pkg/active/lib -L/usr/local/lib     -lruby-static -lnsl  -lpthread -ldl -lobjc "
ld: library not found for -lnsl
collect2: ld returned 1 exit status
checked program was:
/* begin */
1: #include "ruby.h"
2: 
3: /*top*/
4: int main() {return 0;}
5: extern int t(void);
6: int t(void) { t_open(); return 0; }
/* end */

--------------------

have_library: checking for socket() in -lsocket... -------------------- no

"/usr/bin/gcc-4.2 -o conftest -I../../.ext/include/x86_64-darwin12.2.0 -I../.././include -I../.././ext/socket -I../.. -I../../. -D_XOPEN_SOURCE -D_DARWIN_C_SOURCE   -I/Users/fabio/.sm/pkg/active/include -pipe conftest.c  -L. -L../.. -L. -Bstatic -L/Users/fabio/.sm/pkg/active/lib -L/usr/local/lib     -lruby-static -lsocket  -lpthread -ldl -lobjc "
conftest.c: In function ‘t’:
conftest.c:6: error: ‘socket’ undeclared (first use in this function)
conftest.c:6: error: (Each undeclared identifier is reported only once
conftest.c:6: error: for each function it appears in.)
checked program was:
/* begin */
1: #include "ruby.h"
2: 
3: /*top*/
4: int main() {return 0;}
5: extern int t(void);
6: int t(void) { void ((*volatile p)()); p = (void ((*)()))socket; return 0; }
/* end */

"/usr/bin/gcc-4.2 -o conftest -I../../.ext/include/x86_64-darwin12.2.0 -I../.././include -I../.././ext/socket -I../.. -I../../. -D_XOPEN_SOURCE -D_DARWIN_C_SOURCE   -I/Users/fabio/.sm/pkg/active/include -pipe conftest.c  -L. -L../.. -L. -Bstatic -L/Users/fabio/.sm/pkg/active/lib -L/usr/local/lib     -lruby-static -lsocket  -lpthread -ldl -lobjc "
ld: library not found for -lsocket
collect2: ld returned 1 exit status
checked program was:
/* begin */
1: #include "ruby.h"
2: 
3: /*top*/
4: int main() {return 0;}
5: extern int t(void);
6: int t(void) { socket(); return 0; }
/* end */

--------------------

have_header: checking for arpa/inet.h... -------------------- yes

"/usr/bin/gcc-4.2 -E -I../../.ext/include/x86_64-darwin12.2.0 -I../.././include -I../.././ext/socket -I../.. -I../../. -D_XOPEN_SOURCE -D_DARWIN_C_SOURCE   -I/Users/fabio/.sm/pkg/active/include -pipe  conftest.c -o conftest.i"
checked program was:
/* begin */
1: #include "ruby.h"
2: 
3: #include <arpa/inet.h>
/* end */

--------------------

checking for ipv6... -------------------- yes

"/usr/bin/gcc-4.2 -o conftest -I../../.ext/include/x86_64-darwin12.2.0 -I../.././include -I../.././ext/socket -I../.. -I../../. -D_XOPEN_SOURCE -D_DARWIN_C_SOURCE   -I/Users/fabio/.sm/pkg/active/include -pipe conftest.c  -L. -L../.. -L. -Bstatic -L/Users/fabio/.sm/pkg/active/lib -L/usr/local/lib     -lruby-static  -lpthread -ldl -lobjc "
checked program was:
/* begin */
 1: #include "ruby.h"
 2: 
 3: #include <sys/types.h>
 4: #ifndef _WIN32
 5: #include <sys/socket.h>
 6: #endif
 7: int
 8: main()
 9: {
10:   socket(AF_INET6, SOCK_STREAM, 0);
11: }
/* end */

--------------------

checking for ipv6 type... -------------------- kame

have_macro: checking for IPV6_INRIA_VERSION in netinet/in.h... -------------------- no

"/usr/bin/gcc-4.2 -I../../.ext/include/x86_64-darwin12.2.0 -I../.././include -I../.././ext/socket -I../.. -I../../. -D_XOPEN_SOURCE -D_DARWIN_C_SOURCE   -I/Users/fabio/.sm/pkg/active/include -pipe   -c conftest.c"
conftest.c:6:3: error: #error 
conftest.c:7: error: expected identifier or ‘(’ before ‘>>’ token
checked program was:
/* begin */
1: #include "ruby.h"
2: 
3: #include <netinet/in.h>
4: /*top*/
5: #ifndef IPV6_INRIA_VERSION
6: # error
7: >>>>>> IPV6_INRIA_VERSION undefined <<<<<<
8: #endif
/* end */

--------------------

have_macro: checking for __KAME__ in netinet/in.h... -------------------- yes

"/usr/bin/gcc-4.2 -I../../.ext/include/x86_64-darwin12.2.0 -I../.././include -I../.././ext/socket -I../.. -I../../. -D_XOPEN_SOURCE -D_DARWIN_C_SOURCE   -I/Users/fabio/.sm/pkg/active/include -pipe   -c conftest.c"
checked program was:
/* begin */
1: #include "ruby.h"
2: 
3: #include <netinet/in.h>
4: /*top*/
5: #ifndef __KAME__
6: # error
7: >>>>>> __KAME__ undefined <<<<<<
8: #endif
/* end */

--------------------

have_library: checking for main() in -linet6... -------------------- no

"/usr/bin/gcc-4.2 -o conftest -I../../.ext/include/x86_64-darwin12.2.0 -I../.././include -I../.././ext/socket -I../.. -I../../. -D_XOPEN_SOURCE -D_DARWIN_C_SOURCE   -I/Users/fabio/.sm/pkg/active/include -pipe conftest.c  -L. -L../.. -L. -Bstatic -L/Users/fabio/.sm/pkg/active/lib -L/usr/local/lib     -lruby-static -linet6  -lpthread -ldl -lobjc "
ld: library not found for -linet6
collect2: ld returned 1 exit status
checked program was:
/* begin */
1: #include "ruby.h"
2: 
3: /*top*/
4: int main() {return 0;}
5: extern int t(void);
6: int t(void) { void ((*volatile p)()); p = (void ((*)()))main; return 0; }
/* end */

"/usr/bin/gcc-4.2 -o conftest -I../../.ext/include/x86_64-darwin12.2.0 -I../.././include -I../.././ext/socket -I../.. -I../../. -D_XOPEN_SOURCE -D_DARWIN_C_SOURCE   -I/Users/fabio/.sm/pkg/active/include -pipe conftest.c  -L. -L../.. -L. -Bstatic -L/Users/fabio/.sm/pkg/active/lib -L/usr/local/lib     -lruby-static -linet6  -lpthread -ldl -lobjc "
ld: library not found for -linet6
collect2: ld returned 1 exit status
checked program was:
/* begin */
1: #include "ruby.h"
2: 
3: /*top*/
4: int main() {return 0;}
5: extern int t(void);
6: int t(void) { main(); return 0; }
/* end */

--------------------

--------------------

have_struct_member: checking for struct sockaddr_in.sin_len in sys/types.h,netdb.h,string.h,sys/socket.h,netinet/in.h,arpa/inet.h... -------------------- yes

"/usr/bin/gcc-4.2 -I../../.ext/include/x86_64-darwin12.2.0 -I../.././include -I../.././ext/socket -I../.. -I../../. -D_XOPEN_SOURCE -D_DARWIN_C_SOURCE   -I/Users/fabio/.sm/pkg/active/include -pipe   -c conftest.c"
checked program was:
/* begin */
 1: #include "ruby.h"
 2: 
 3: #include <sys/types.h>
 4: #include <netdb.h>
 5: #include <string.h>
 6: #include <sys/socket.h>
 7: #include <netinet/in.h>
 8: #include <arpa/inet.h>
 9: 
10: /*top*/
11: int main() {return 0;}
12: int s = (char *)&((struct sockaddr_in*)0)->sin_len - (char *)0;
/* end */

--------------------

have_struct_member: checking for struct sockaddr_storage.ss_family in sys/types.h,netdb.h,string.h,sys/socket.h,netinet/in.h,arpa/inet.h... -------------------- yes

"/usr/bin/gcc-4.2 -I../../.ext/include/x86_64-darwin12.2.0 -I../.././include -I../.././ext/socket -I../.. -I../../. -D_XOPEN_SOURCE -D_DARWIN_C_SOURCE   -I/Users/fabio/.sm/pkg/active/include -pipe   -c conftest.c"
checked program was:
/* begin */
 1: #include "ruby.h"
 2: 
 3: #include <sys/types.h>
 4: #include <netdb.h>
 5: #include <string.h>
 6: #include <sys/socket.h>
 7: #include <netinet/in.h>
 8: #include <arpa/inet.h>
 9: 
10: /*top*/
11: int main() {return 0;}
12: int s = (char *)&((struct sockaddr_storage*)0)->ss_family - (char *)0;
/* end */

--------------------

have_struct_member: checking for struct sockaddr_storage.ss_len in sys/types.h,netdb.h,string.h,sys/socket.h,netinet/in.h,arpa/inet.h... -------------------- yes

"/usr/bin/gcc-4.2 -I../../.ext/include/x86_64-darwin12.2.0 -I../.././include -I../.././ext/socket -I../.. -I../../. -D_XOPEN_SOURCE -D_DARWIN_C_SOURCE   -I/Users/fabio/.sm/pkg/active/include -pipe   -c conftest.c"
checked program was:
/* begin */
 1: #include "ruby.h"
 2: 
 3: #include <sys/types.h>
 4: #include <netdb.h>
 5: #include <string.h>
 6: #include <sys/socket.h>
 7: #include <netinet/in.h>
 8: #include <arpa/inet.h>
 9: 
10: /*top*/
11: int main() {return 0;}
12: int s = (char *)&((struct sockaddr_storage*)0)->ss_len - (char *)0;
/* end */

--------------------

have_struct_member: checking for struct sockaddr.sa_len in sys/types.h,netdb.h,string.h,sys/socket.h,netinet/in.h,arpa/inet.h... -------------------- yes

"/usr/bin/gcc-4.2 -I../../.ext/include/x86_64-darwin12.2.0 -I../.././include -I../.././ext/socket -I../.. -I../../. -D_XOPEN_SOURCE -D_DARWIN_C_SOURCE   -I/Users/fabio/.sm/pkg/active/include -pipe   -c conftest.c"
checked program was:
/* begin */
 1: #include "ruby.h"
 2: 
 3: #include <sys/types.h>
 4: #include <netdb.h>
 5: #include <string.h>
 6: #include <sys/socket.h>
 7: #include <netinet/in.h>
 8: #include <arpa/inet.h>
 9: 
10: /*top*/
11: int main() {return 0;}
12: int s = (char *)&((struct sockaddr*)0)->sa_len - (char *)0;
/* end */

--------------------

have_header: checking for netinet/tcp.h... -------------------- yes

"/usr/bin/gcc-4.2 -E -I../../.ext/include/x86_64-darwin12.2.0 -I../.././include -I../.././ext/socket -I../.. -I../../. -D_XOPEN_SOURCE -D_DARWIN_C_SOURCE   -I/Users/fabio/.sm/pkg/active/include -pipe  conftest.c -o conftest.i"
checked program was:
/* begin */
1: #include "ruby.h"
2: 
3: #include <netinet/tcp.h>
/* end */

--------------------

have_header: checking for netinet/udp.h... -------------------- yes

"/usr/bin/gcc-4.2 -E -I../../.ext/include/x86_64-darwin12.2.0 -I../.././include -I../.././ext/socket -I../.. -I../../. -D_XOPEN_SOURCE -D_DARWIN_C_SOURCE   -I/Users/fabio/.sm/pkg/active/include -pipe  conftest.c -o conftest.i"
checked program was:
/* begin */
1: #include "ruby.h"
2: 
3: #include <netinet/udp.h>
/* end */

--------------------

have_macro: checking for IPPROTO_IPV6 in sys/types.h,netdb.h,string.h,sys/socket.h,netinet/in.h,arpa/inet.h... -------------------- yes

"/usr/bin/gcc-4.2 -I../../.ext/include/x86_64-darwin12.2.0 -I../.././include -I../.././ext/socket -I../.. -I../../. -D_XOPEN_SOURCE -D_DARWIN_C_SOURCE   -I/Users/fabio/.sm/pkg/active/include -pipe   -c conftest.c"
checked program was:
/* begin */
 1: #include "ruby.h"
 2: 
 3: #include <sys/types.h>
 4: #include <netdb.h>
 5: #include <string.h>
 6: #include <sys/socket.h>
 7: #include <netinet/in.h>
 8: #include <arpa/inet.h>
 9: /*top*/
10: #ifndef IPPROTO_IPV6
11: # error
12: >>>>>> IPPROTO_IPV6 undefined <<<<<<
13: #endif
/* end */

--------------------

have_func: checking for sendmsg()... -------------------- yes

"/usr/bin/gcc-4.2 -o conftest -I../../.ext/include/x86_64-darwin12.2.0 -I../.././include -I../.././ext/socket -I../.. -I../../. -D_XOPEN_SOURCE -D_DARWIN_C_SOURCE   -I/Users/fabio/.sm/pkg/active/include -pipe conftest.c  -L. -L../.. -L. -Bstatic -L/Users/fabio/.sm/pkg/active/lib -L/usr/local/lib     -lruby-static  -lpthread -ldl -lobjc "
conftest.c: In function ‘t’:
conftest.c:6: error: ‘sendmsg’ undeclared (first use in this function)
conftest.c:6: error: (Each undeclared identifier is reported only once
conftest.c:6: error: for each function it appears in.)
checked program was:
/* begin */
1: #include "ruby.h"
2: 
3: /*top*/
4: int main() {return 0;}
5: extern int t(void);
6: int t(void) { void ((*volatile p)()); p = (void ((*)()))sendmsg; return 0; }
/* end */

"/usr/bin/gcc-4.2 -o conftest -I../../.ext/include/x86_64-darwin12.2.0 -I../.././include -I../.././ext/socket -I../.. -I../../. -D_XOPEN_SOURCE -D_DARWIN_C_SOURCE   -I/Users/fabio/.sm/pkg/active/include -pipe conftest.c  -L. -L../.. -L. -Bstatic -L/Users/fabio/.sm/pkg/active/lib -L/usr/local/lib     -lruby-static  -lpthread -ldl -lobjc "
checked program was:
/* begin */
1: #include "ruby.h"
2: 
3: /*top*/
4: int main() {return 0;}
5: extern int t(void);
6: int t(void) { sendmsg(); return 0; }
/* end */

--------------------

have_func: checking for recvmsg()... -------------------- yes

"/usr/bin/gcc-4.2 -o conftest -I../../.ext/include/x86_64-darwin12.2.0 -I../.././include -I../.././ext/socket -I../.. -I../../. -D_XOPEN_SOURCE -D_DARWIN_C_SOURCE   -I/Users/fabio/.sm/pkg/active/include -pipe conftest.c  -L. -L../.. -L. -Bstatic -L/Users/fabio/.sm/pkg/active/lib -L/usr/local/lib     -lruby-static  -lpthread -ldl -lobjc "
conftest.c: In function ‘t’:
conftest.c:6: error: ‘recvmsg’ undeclared (first use in this function)
conftest.c:6: error: (Each undeclared identifier is reported only once
conftest.c:6: error: for each function it appears in.)
checked program was:
/* begin */
1: #include "ruby.h"
2: 
3: /*top*/
4: int main() {return 0;}
5: extern int t(void);
6: int t(void) { void ((*volatile p)()); p = (void ((*)()))recvmsg; return 0; }
/* end */

"/usr/bin/gcc-4.2 -o conftest -I../../.ext/include/x86_64-darwin12.2.0 -I../.././include -I../.././ext/socket -I../.. -I../../. -D_XOPEN_SOURCE -D_DARWIN_C_SOURCE   -I/Users/fabio/.sm/pkg/active/include -pipe conftest.c  -L. -L../.. -L. -Bstatic -L/Users/fabio/.sm/pkg/active/lib -L/usr/local/lib     -lruby-static  -lpthread -ldl -lobjc "
checked program was:
/* begin */
1: #include "ruby.h"
2: 
3: /*top*/
4: int main() {return 0;}
5: extern int t(void);
6: int t(void) { recvmsg(); return 0; }
/* end */

--------------------

have_struct_member: checking for struct msghdr.msg_control in sys/types.h,sys/socket.h... -------------------- yes

"/usr/bin/gcc-4.2 -I../../.ext/include/x86_64-darwin12.2.0 -I../.././include -I../.././ext/socket -I../.. -I../../. -D_XOPEN_SOURCE -D_DARWIN_C_SOURCE   -I/Users/fabio/.sm/pkg/active/include -pipe   -c conftest.c"
checked program was:
/* begin */
1: #include "ruby.h"
2: 
3: #include <sys/types.h>
4: #include <sys/socket.h>
5: 
6: /*top*/
7: int main() {return 0;}
8: int s = (char *)&((struct msghdr*)0)->msg_control - (char *)0;
/* end */

--------------------

have_struct_member: checking for struct msghdr.msg_accrights in sys/types.h,sys/socket.h... -------------------- no

"/usr/bin/gcc-4.2 -I../../.ext/include/x86_64-darwin12.2.0 -I../.././include -I../.././ext/socket -I../.. -I../../. -D_XOPEN_SOURCE -D_DARWIN_C_SOURCE   -I/Users/fabio/.sm/pkg/active/include -pipe   -c conftest.c"
conftest.c:8: error: ‘struct msghdr’ has no member named ‘msg_accrights’
checked program was:
/* begin */
1: #include "ruby.h"
2: 
3: #include <sys/types.h>
4: #include <sys/socket.h>
5: 
6: /*top*/
7: int main() {return 0;}
8: int s = (char *)&((struct msghdr*)0)->msg_accrights - (char *)0;
/* end */

--------------------

checking for recvmsg() with MSG_PEEK allocate file descriptors... -------------------- no

"/usr/bin/gcc-4.2 -o conftest -I../../.ext/include/x86_64-darwin12.2.0 -I../.././include -I../.././ext/socket -I../.. -I../../. -D_XOPEN_SOURCE -D_DARWIN_C_SOURCE   -I/Users/fabio/.sm/pkg/active/include -pipe conftest.c  -L. -L../.. -L. -Bstatic -L/Users/fabio/.sm/pkg/active/lib -L/usr/local/lib     -lruby-static  -lpthread -ldl -lobjc "
checked program was:
/* begin */
  1: #include "ruby.h"
  2: 
  3: #include <sys/types.h>
  4: #include <netdb.h>
  5: #include <string.h>
  6: #include <sys/socket.h>
  7: #include <netinet/in.h>
  8: #include <arpa/inet.h>
  9: #include <stdlib.h>
 10: #include <stdio.h>
 11: #include <string.h>
 12: #include <sys/types.h>
 13: #include <sys/stat.h>
 14: #include <sys/socket.h>
 15: #include <sys/un.h>
 16: #include <unistd.h>
 17: 
 18: int main(int argc, char *argv[])
 19: {
 20:     int ps[2], sv[2];
 21:     int ret;
 22:     ssize_t ss;
 23:     int s_fd, r_fd;
 24:     struct msghdr s_msg, r_msg;
 25:     union {
 26:         struct cmsghdr hdr;
 27:         char dummy[CMSG_SPACE(sizeof(int))];
 28:     } s_cmsg, r_cmsg;
 29:     struct iovec s_iov, r_iov;
 30:     char s_buf[1], r_buf[1];
 31:     struct stat s_statbuf, r_statbuf;
 32: 
 33:     ret = pipe(ps);
 34:     if (ret == -1) { perror("pipe"); exit(EXIT_FAILURE); }
 35: 
 36:     s_fd = ps[0];
 37: 
 38:     ret = socketpair(AF_UNIX, SOCK_DGRAM, 0, sv);
 39:     if (ret == -1) { perror("socketpair"); exit(EXIT_FAILURE); }
 40: 
 41:     s_msg.msg_name = NULL;
 42:     s_msg.msg_namelen = 0;
 43:     s_msg.msg_iov = &s_iov;
 44:     s_msg.msg_iovlen = 1;
 45:     s_msg.msg_control = &s_cmsg;
 46:     s_msg.msg_controllen = CMSG_SPACE(sizeof(int));;
 47:     s_msg.msg_flags = 0;
 48: 
 49:     s_iov.iov_base = &s_buf;
 50:     s_iov.iov_len = sizeof(s_buf);
 51: 
 52:     s_buf[0] = 'a';
 53: 
 54:     s_cmsg.hdr.cmsg_len = CMSG_LEN(sizeof(int));
 55:     s_cmsg.hdr.cmsg_level = SOL_SOCKET;
 56:     s_cmsg.hdr.cmsg_type = SCM_RIGHTS;
 57:     memcpy(CMSG_DATA(&s_cmsg.hdr), (char *)&s_fd, sizeof(int));
 58: 
 59:     ss = sendmsg(sv[0], &s_msg, 0);
 60:     if (ss == -1) { perror("sendmsg"); exit(EXIT_FAILURE); }
 61: 
 62:     r_msg.msg_name = NULL;
 63:     r_msg.msg_namelen = 0;
 64:     r_msg.msg_iov = &r_iov;
 65:     r_msg.msg_iovlen = 1;
 66:     r_msg.msg_control = &r_cmsg;
 67:     r_msg.msg_controllen = CMSG_SPACE(sizeof(int));
 68:     r_msg.msg_flags = 0;
 69: 
 70:     r_iov.iov_base = &r_buf;
 71:     r_iov.iov_len = sizeof(r_buf);
 72: 
 73:     r_buf[0] = '0';
 74: 
 75:     memset(&r_cmsg, 0xff, CMSG_SPACE(sizeof(int)));
 76: 
 77:     ss = recvmsg(sv[1], &r_msg, MSG_PEEK);
 78:     if (ss == -1) { perror("recvmsg"); exit(EXIT_FAILURE); }
 79: 
 80:     if (ss != 1) {
 81:         fprintf(stderr, "unexpected return value from recvmsg: %ld\n", (long)ss);
 82:         exit(EXIT_FAILURE);
 83:     }
 84:     if (r_buf[0] != 'a') {
 85:         fprintf(stderr, "unexpected return data from recvmsg: 0x%02x\n", r_buf[0]);
 86:         exit(EXIT_FAILURE);
 87:     }
 88: 
 89:     if (r_msg.msg_controllen < CMSG_LEN(sizeof(int))) {
 90:         fprintf(stderr, "unexpected: r_msg.msg_controllen < CMSG_LEN(sizeof(int)) not hold: %ld\n",
 91:                 (long)r_msg.msg_controllen);
 92:         exit(EXIT_FAILURE);
 93:     }
 94:     if (r_cmsg.hdr.cmsg_len < CMSG_LEN(sizeof(int))) {
 95:         fprintf(stderr, "unexpected: r_cmsg.hdr.cmsg_len < CMSG_LEN(sizeof(int)) not hold: %ld\n",
 96:                 (long)r_cmsg.hdr.cmsg_len);
 97:         exit(EXIT_FAILURE);
 98:     }
 99:     memcpy((char *)&r_fd, CMSG_DATA(&r_cmsg.hdr), sizeof(int));
100: 
101:     if (r_fd < 0) {
102:         fprintf(stderr, "negative r_fd: %d\n", r_fd);
103:         exit(EXIT_FAILURE);
104:     }
105: 
106:     if (r_fd == s_fd) {
107:         fprintf(stderr, "r_fd and s_fd is same: %d\n", r_fd);
108:         exit(EXIT_FAILURE);
109:     }
110: 
111:     ret = fstat(s_fd, &s_statbuf);
112:     if (ret == -1) { perror("fstat(s_fd)"); exit(EXIT_FAILURE); }
113: 
114:     ret = fstat(r_fd, &r_statbuf);
115:     if (ret == -1) { perror("fstat(r_fd)"); exit(EXIT_FAILURE); }
116: 
117:     if (s_statbuf.st_dev != r_statbuf.st_dev ||
118:         s_statbuf.st_ino != r_statbuf.st_ino) {
119:         fprintf(stderr, "dev/ino doesn't match: s_fd:%ld/%ld r_fd:%ld/%ld\n",
120:                 (long)s_statbuf.st_dev, (long)s_statbuf.st_ino,
121:                 (long)r_statbuf.st_dev, (long)r_statbuf.st_ino);
122:         exit(EXIT_FAILURE);
123:     }
124: 
125:     return EXIT_SUCCESS;
126: }
/* end */

./conftest
fstat(r_fd): Bad file descriptor
--------------------

checking for wide getaddrinfo... -------------------- yes

"/usr/bin/gcc-4.2 -o conftest -I../../.ext/include/x86_64-darwin12.2.0 -I../.././include -I../.././ext/socket -I../.. -I../../. -D_XOPEN_SOURCE -D_DARWIN_C_SOURCE   -I/Users/fabio/.sm/pkg/active/include -pipe conftest.c  -L. -L../.. -L. -Bstatic -L/Users/fabio/.sm/pkg/active/lib -L/usr/local/lib     -lruby-static  -lpthread -ldl -lobjc "
checked program was:
/* begin */
  1: #include "ruby.h"
  2: 
  3: #include <sys/types.h>
  4: #include <netdb.h>
  5: #include <string.h>
  6: #include <sys/socket.h>
  7: #include <netinet/in.h>
  8: #include <arpa/inet.h>
  9: 
 10: #include <stdlib.h>
 11: 
 12: #ifndef EXIT_SUCCESS
 13: #define EXIT_SUCCESS 0
 14: #endif
 15: #ifndef EXIT_FAILURE
 16: #define EXIT_FAILURE 1
 17: #endif
 18: 
 19: #ifndef AF_LOCAL
 20: #define AF_LOCAL AF_UNIX
 21: #endif
 22: 
 23: int
 24: main()
 25: {
 26:   int passive, gaierr, inet4 = 0, inet6 = 0;
 27:   struct addrinfo hints, *ai, *aitop;
 28:   char straddr[INET6_ADDRSTRLEN], strport[16];
 29: #ifdef _WIN32
 30:   WSADATA retdata;
 31: 
 32:   WSAStartup(MAKEWORD(2, 0), &retdata);
 33: #endif
 34: 
 35:   for (passive = 0; passive <= 1; passive++) {
 36:     memset(&hints, 0, sizeof(hints));
 37:     hints.ai_family = AF_UNSPEC;
 38:     hints.ai_protocol = IPPROTO_TCP;
 39:     hints.ai_flags = passive ? AI_PASSIVE : 0;
 40:     hints.ai_socktype = SOCK_STREAM;
 41:     if ((gaierr = getaddrinfo(NULL, "54321", &hints, &aitop)) != 0) {
 42:       (void)gai_strerror(gaierr);
 43:       goto bad;
 44:     }
 45:     for (ai = aitop; ai; ai = ai->ai_next) {
 46:       if (ai->ai_family == AF_LOCAL) continue;
 47:       if (ai->ai_addr == NULL)
 48:         goto bad;
 49: #if defined(_AIX)
 50:       if (ai->ai_family == AF_INET6 && passive) {
 51:         inet6++;
 52:         continue;
 53:       }
 54:       ai->ai_addr->sa_len = ai->ai_addrlen;
 55:       ai->ai_addr->sa_family = ai->ai_family;
 56: #endif
 57:       if (ai->ai_addrlen == 0 ||
 58:           getnameinfo(ai->ai_addr, ai->ai_addrlen,
 59:                       straddr, sizeof(straddr), strport, sizeof(strport),
 60:                       NI_NUMERICHOST|NI_NUMERICSERV) != 0) {
 61:         goto bad;
 62:       }
 63:       if (strcmp(strport, "54321") != 0) {
 64:         goto bad;
 65:       }
 66:       switch (ai->ai_family) {
 67:       case AF_INET:
 68:         if (passive) {
 69:           if (strcmp(straddr, "0.0.0.0") != 0) {
 70:             goto bad;
 71:           }
 72:         } else {
 73:           if (strcmp(straddr, "127.0.0.1") != 0) {
 74:             goto bad;
 75:           }
 76:         }
 77:         inet4++;
 78:         break;
 79:       case AF_INET6:
 80:         if (passive) {
 81:           if (strcmp(straddr, "::") != 0) {
 82:             goto bad;
 83:           }
 84:         } else {
 85:           if (strcmp(straddr, "::1") != 0) {
 86:             goto bad;
 87:           }
 88:         }
 89:         inet6++;
 90:         break;
 91:       case AF_UNSPEC:
 92:         goto bad;
 93:         break;
 94:       default:
 95:         /* another family support? */
 96:         break;
 97:       }
 98:     }
 99:   }
100: 
101:   if (!(inet4 == 0 || inet4 == 2))
102:     goto bad;
103:   if (!(inet6 == 0 || inet6 == 2))
104:     goto bad;
105: 
106:   if (aitop)
107:     freeaddrinfo(aitop);
108:   exit(EXIT_SUCCESS);
109: 
110:  bad:
111:   if (aitop)
112:     freeaddrinfo(aitop);
113:   exit(EXIT_FAILURE);
114: }
/* end */

./conftest
--------------------

have_type: checking for struct addrinfo in sys/types.h,netdb.h,string.h,sys/socket.h,netinet/in.h,arpa/inet.h... -------------------- yes

"/usr/bin/gcc-4.2 -I../../.ext/include/x86_64-darwin12.2.0 -I../.././include -I../.././ext/socket -I../.. -I../../. -D_XOPEN_SOURCE -D_DARWIN_C_SOURCE   -I/Users/fabio/.sm/pkg/active/include -pipe   -c conftest.c"
checked program was:
/* begin */
 1: #include "ruby.h"
 2: 
 3: #include <sys/types.h>
 4: #include <netdb.h>
 5: #include <string.h>
 6: #include <sys/socket.h>
 7: #include <netinet/in.h>
 8: #include <arpa/inet.h>
 9: 
10: /*top*/
11: typedef struct addrinfo conftest_type;
12: int conftestval[sizeof(conftest_type)?1:-1];
/* end */

--------------------

have_func: checking for freehostent()... -------------------- yes

"/usr/bin/gcc-4.2 -o conftest -I../../.ext/include/x86_64-darwin12.2.0 -I../.././include -I../.././ext/socket -I../.. -I../../. -D_XOPEN_SOURCE -D_DARWIN_C_SOURCE   -I/Users/fabio/.sm/pkg/active/include -pipe conftest.c  -L. -L../.. -L. -Bstatic -L/Users/fabio/.sm/pkg/active/lib -L/usr/local/lib     -lruby-static  -lpthread -ldl -lobjc "
conftest.c: In function ‘t’:
conftest.c:6: error: ‘freehostent’ undeclared (first use in this function)
conftest.c:6: error: (Each undeclared identifier is reported only once
conftest.c:6: error: for each function it appears in.)
checked program was:
/* begin */
1: #include "ruby.h"
2: 
3: /*top*/
4: int main() {return 0;}
5: extern int t(void);
6: int t(void) { void ((*volatile p)()); p = (void ((*)()))freehostent; return 0; }
/* end */

"/usr/bin/gcc-4.2 -o conftest -I../../.ext/include/x86_64-darwin12.2.0 -I../.././include -I../.././ext/socket -I../.. -I../../. -D_XOPEN_SOURCE -D_DARWIN_C_SOURCE   -I/Users/fabio/.sm/pkg/active/include -pipe conftest.c  -L. -L../.. -L. -Bstatic -L/Users/fabio/.sm/pkg/active/lib -L/usr/local/lib     -lruby-static  -lpthread -ldl -lobjc "
checked program was:
/* begin */
1: #include "ruby.h"
2: 
3: /*top*/
4: int main() {return 0;}
5: extern int t(void);
6: int t(void) { freehostent(); return 0; }
/* end */

--------------------

have_func: checking for freeaddrinfo()... -------------------- yes

"/usr/bin/gcc-4.2 -o conftest -I../../.ext/include/x86_64-darwin12.2.0 -I../.././include -I../.././ext/socket -I../.. -I../../. -D_XOPEN_SOURCE -D_DARWIN_C_SOURCE   -I/Users/fabio/.sm/pkg/active/include -pipe conftest.c  -L. -L../.. -L. -Bstatic -L/Users/fabio/.sm/pkg/active/lib -L/usr/local/lib     -lruby-static  -lpthread -ldl -lobjc "
conftest.c: In function ‘t’:
conftest.c:6: error: ‘freeaddrinfo’ undeclared (first use in this function)
conftest.c:6: error: (Each undeclared identifier is reported only once
conftest.c:6: error: for each function it appears in.)
checked program was:
/* begin */
1: #include "ruby.h"
2: 
3: /*top*/
4: int main() {return 0;}
5: extern int t(void);
6: int t(void) { void ((*volatile p)()); p = (void ((*)()))freeaddrinfo; return 0; }
/* end */

"/usr/bin/gcc-4.2 -o conftest -I../../.ext/include/x86_64-darwin12.2.0 -I../.././include -I../.././ext/socket -I../.. -I../../. -D_XOPEN_SOURCE -D_DARWIN_C_SOURCE   -I/Users/fabio/.sm/pkg/active/include -pipe conftest.c  -L. -L../.. -L. -Bstatic -L/Users/fabio/.sm/pkg/active/lib -L/usr/local/lib     -lruby-static  -lpthread -ldl -lobjc "
checked program was:
/* begin */
1: #include "ruby.h"
2: 
3: /*top*/
4: int main() {return 0;}
5: extern int t(void);
6: int t(void) { freeaddrinfo(); return 0; }
/* end */

--------------------

have_func: checking for gai_strerror()... -------------------- yes

"/usr/bin/gcc-4.2 -o conftest -I../../.ext/include/x86_64-darwin12.2.0 -I../.././include -I../.././ext/socket -I../.. -I../../. -D_XOPEN_SOURCE -D_DARWIN_C_SOURCE   -I/Users/fabio/.sm/pkg/active/include -pipe conftest.c  -L. -L../.. -L. -Bstatic -L/Users/fabio/.sm/pkg/active/lib -L/usr/local/lib     -lruby-static  -lpthread -ldl -lobjc "
conftest.c: In function ‘t’:
conftest.c:6: error: ‘gai_strerror’ undeclared (first use in this function)
conftest.c:6: error: (Each undeclared identifier is reported only once
conftest.c:6: error: for each function it appears in.)
checked program was:
/* begin */
1: #include "ruby.h"
2: 
3: /*top*/
4: int main() {return 0;}
5: extern int t(void);
6: int t(void) { void ((*volatile p)()); p = (void ((*)()))gai_strerror; return 0; }
/* end */

"/usr/bin/gcc-4.2 -o conftest -I../../.ext/include/x86_64-darwin12.2.0 -I../.././include -I../.././ext/socket -I../.. -I../../. -D_XOPEN_SOURCE -D_DARWIN_C_SOURCE   -I/Users/fabio/.sm/pkg/active/include -pipe conftest.c  -L. -L../.. -L. -Bstatic -L/Users/fabio/.sm/pkg/active/lib -L/usr/local/lib     -lruby-static  -lpthread -ldl -lobjc "
checked program was:
/* begin */
1: #include "ruby.h"
2: 
3: /*top*/
4: int main() {return 0;}
5: extern int t(void);
6: int t(void) { gai_strerror(); return 0; }
/* end */

--------------------

checking for gai_strerror() returns const pointer... -------------------- yes

"/usr/bin/gcc-4.2 -I../../.ext/include/x86_64-darwin12.2.0 -I../.././include -I../.././ext/socket -I../.. -I../../. -D_XOPEN_SOURCE -D_DARWIN_C_SOURCE   -I/Users/fabio/.sm/pkg/active/include -pipe   -c conftest.c"
conftest.c: In function ‘conftest_gai_strerror_is_const’:
conftest.c:14: error: assignment of read-only location
checked program was:
/* begin */
 1: #include "ruby.h"
 2: 
 3: #include <sys/types.h>
 4: #include <netdb.h>
 5: #include <string.h>
 6: #include <sys/socket.h>
 7: #include <netinet/in.h>
 8: #include <arpa/inet.h>
 9: 
10: #include <stdlib.h>
11: void
12: conftest_gai_strerror_is_const()
13: {
14:     *gai_strerror(0) = 0;
15: }
/* end */

--------------------

have_func: checking for getnameinfo() in sys/types.h,netdb.h,string.h,sys/socket.h,netinet/in.h,arpa/inet.h... -------------------- yes

"/usr/bin/gcc-4.2 -o conftest -I../../.ext/include/x86_64-darwin12.2.0 -I../.././include -I../.././ext/socket -I../.. -I../../. -D_XOPEN_SOURCE -D_DARWIN_C_SOURCE   -I/Users/fabio/.sm/pkg/active/include -pipe conftest.c  -L. -L../.. -L. -Bstatic -L/Users/fabio/.sm/pkg/active/lib -L/usr/local/lib     -lruby-static  -lpthread -ldl -lobjc "
checked program was:
/* begin */
 1: #include "ruby.h"
 2: 
 3: #include <sys/types.h>
 4: #include <netdb.h>
 5: #include <string.h>
 6: #include <sys/socket.h>
 7: #include <netinet/in.h>
 8: #include <arpa/inet.h>
 9: 
10: /*top*/
11: int main() {return 0;}
12: extern int t(void);
13: int t(void) { void ((*volatile p)()); p = (void ((*)()))getnameinfo; return 0; }
/* end */

--------------------

have_func: checking for getaddrinfo() in sys/types.h,netdb.h,string.h,sys/socket.h,netinet/in.h,arpa/inet.h... -------------------- yes

"/usr/bin/gcc-4.2 -o conftest -I../../.ext/include/x86_64-darwin12.2.0 -I../.././include -I../.././ext/socket -I../.. -I../../. -D_XOPEN_SOURCE -D_DARWIN_C_SOURCE   -I/Users/fabio/.sm/pkg/active/include -pipe conftest.c  -L. -L../.. -L. -Bstatic -L/Users/fabio/.sm/pkg/active/lib -L/usr/local/lib     -lruby-static  -lpthread -ldl -lobjc "
checked program was:
/* begin */
 1: #include "ruby.h"
 2: 
 3: #include <sys/types.h>
 4: #include <netdb.h>
 5: #include <string.h>
 6: #include <sys/socket.h>
 7: #include <netinet/in.h>
 8: #include <arpa/inet.h>
 9: 
10: /*top*/
11: int main() {return 0;}
12: extern int t(void);
13: int t(void) { void ((*volatile p)()); p = (void ((*)()))getaddrinfo; return 0; }
/* end */

--------------------

have_func: checking for inet_ntop()... -------------------- yes

"/usr/bin/gcc-4.2 -o conftest -I../../.ext/include/x86_64-darwin12.2.0 -I../.././include -I../.././ext/socket -I../.. -I../../. -D_XOPEN_SOURCE -D_DARWIN_C_SOURCE   -I/Users/fabio/.sm/pkg/active/include -pipe conftest.c  -L. -L../.. -L. -Bstatic -L/Users/fabio/.sm/pkg/active/lib -L/usr/local/lib     -lruby-static  -lpthread -ldl -lobjc "
conftest.c: In function ‘t’:
conftest.c:6: error: ‘inet_ntop’ undeclared (first use in this function)
conftest.c:6: error: (Each undeclared identifier is reported only once
conftest.c:6: error: for each function it appears in.)
checked program was:
/* begin */
1: #include "ruby.h"
2: 
3: /*top*/
4: int main() {return 0;}
5: extern int t(void);
6: int t(void) { void ((*volatile p)()); p = (void ((*)()))inet_ntop; return 0; }
/* end */

"/usr/bin/gcc-4.2 -o conftest -I../../.ext/include/x86_64-darwin12.2.0 -I../.././include -I../.././ext/socket -I../.. -I../../. -D_XOPEN_SOURCE -D_DARWIN_C_SOURCE   -I/Users/fabio/.sm/pkg/active/include -pipe conftest.c  -L. -L../.. -L. -Bstatic -L/Users/fabio/.sm/pkg/active/lib -L/usr/local/lib     -lruby-static  -lpthread -ldl -lobjc "
checked program was:
/* begin */
1: #include "ruby.h"
2: 
3: /*top*/
4: int main() {return 0;}
5: extern int t(void);
6: int t(void) { inet_ntop(); return 0; }
/* end */

--------------------

have_func: checking for inet_pton()... -------------------- yes

"/usr/bin/gcc-4.2 -o conftest -I../../.ext/include/x86_64-darwin12.2.0 -I../.././include -I../.././ext/socket -I../.. -I../../. -D_XOPEN_SOURCE -D_DARWIN_C_SOURCE   -I/Users/fabio/.sm/pkg/active/include -pipe conftest.c  -L. -L../.. -L. -Bstatic -L/Users/fabio/.sm/pkg/active/lib -L/usr/local/lib     -lruby-static  -lpthread -ldl -lobjc "
conftest.c: In function ‘t’:
conftest.c:6: error: ‘inet_pton’ undeclared (first use in this function)
conftest.c:6: error: (Each undeclared identifier is reported only once
conftest.c:6: error: for each function it appears in.)
checked program was:
/* begin */
1: #include "ruby.h"
2: 
3: /*top*/
4: int main() {return 0;}
5: extern int t(void);
6: int t(void) { void ((*volatile p)()); p = (void ((*)()))inet_pton; return 0; }
/* end */

"/usr/bin/gcc-4.2 -o conftest -I../../.ext/include/x86_64-darwin12.2.0 -I../.././include -I../.././ext/socket -I../.. -I../../. -D_XOPEN_SOURCE -D_DARWIN_C_SOURCE   -I/Users/fabio/.sm/pkg/active/include -pipe conftest.c  -L. -L../.. -L. -Bstatic -L/Users/fabio/.sm/pkg/active/lib -L/usr/local/lib     -lruby-static  -lpthread -ldl -lobjc "
checked program was:
/* begin */
1: #include "ruby.h"
2: 
3: /*top*/
4: int main() {return 0;}
5: extern int t(void);
6: int t(void) { inet_pton(); return 0; }
/* end */

--------------------

have_func: checking for getservbyport()... -------------------- yes

"/usr/bin/gcc-4.2 -o conftest -I../../.ext/include/x86_64-darwin12.2.0 -I../.././include -I../.././ext/socket -I../.. -I../../. -D_XOPEN_SOURCE -D_DARWIN_C_SOURCE   -I/Users/fabio/.sm/pkg/active/include -pipe conftest.c  -L. -L../.. -L. -Bstatic -L/Users/fabio/.sm/pkg/active/lib -L/usr/local/lib     -lruby-static  -lpthread -ldl -lobjc "
conftest.c: In function ‘t’:
conftest.c:6: error: ‘getservbyport’ undeclared (first use in this function)
conftest.c:6: error: (Each undeclared identifier is reported only once
conftest.c:6: error: for each function it appears in.)
checked program was:
/* begin */
1: #include "ruby.h"
2: 
3: /*top*/
4: int main() {return 0;}
5: extern int t(void);
6: int t(void) { void ((*volatile p)()); p = (void ((*)()))getservbyport; return 0; }
/* end */

"/usr/bin/gcc-4.2 -o conftest -I../../.ext/include/x86_64-darwin12.2.0 -I../.././include -I../.././ext/socket -I../.. -I../../. -D_XOPEN_SOURCE -D_DARWIN_C_SOURCE   -I/Users/fabio/.sm/pkg/active/include -pipe conftest.c  -L. -L../.. -L. -Bstatic -L/Users/fabio/.sm/pkg/active/lib -L/usr/local/lib     -lruby-static  -lpthread -ldl -lobjc "
checked program was:
/* begin */
1: #include "ruby.h"
2: 
3: /*top*/
4: int main() {return 0;}
5: extern int t(void);
6: int t(void) { getservbyport(); return 0; }
/* end */

--------------------

have_header: checking for arpa/nameser.h... -------------------- yes

"/usr/bin/gcc-4.2 -E -I../../.ext/include/x86_64-darwin12.2.0 -I../.././include -I../.././ext/socket -I../.. -I../../. -D_XOPEN_SOURCE -D_DARWIN_C_SOURCE   -I/Users/fabio/.sm/pkg/active/include -pipe  conftest.c -o conftest.i"
checked program was:
/* begin */
1: #include "ruby.h"
2: 
3: #include <arpa/nameser.h>
/* end */

--------------------

have_header: checking for resolv.h... -------------------- yes

"/usr/bin/gcc-4.2 -E -I../../.ext/include/x86_64-darwin12.2.0 -I../.././include -I../.././ext/socket -I../.. -I../../. -D_XOPEN_SOURCE -D_DARWIN_C_SOURCE   -I/Users/fabio/.sm/pkg/active/include -pipe  conftest.c -o conftest.i"
checked program was:
/* begin */
1: #include "ruby.h"
2: 
3: #include <resolv.h>
/* end */

--------------------

have_header: checking for ifaddrs.h... -------------------- yes

"/usr/bin/gcc-4.2 -E -I../../.ext/include/x86_64-darwin12.2.0 -I../.././include -I../.././ext/socket -I../.. -I../../. -D_XOPEN_SOURCE -D_DARWIN_C_SOURCE   -I/Users/fabio/.sm/pkg/active/include -pipe  conftest.c -o conftest.i"
checked program was:
/* begin */
1: #include "ruby.h"
2: 
3: #include <ifaddrs.h>
/* end */

--------------------

have_func: checking for getifaddrs()... -------------------- yes

"/usr/bin/gcc-4.2 -o conftest -I../../.ext/include/x86_64-darwin12.2.0 -I../.././include -I../.././ext/socket -I../.. -I../../. -D_XOPEN_SOURCE -D_DARWIN_C_SOURCE   -I/Users/fabio/.sm/pkg/active/include -pipe conftest.c  -L. -L../.. -L. -Bstatic -L/Users/fabio/.sm/pkg/active/lib -L/usr/local/lib     -lruby-static  -lpthread -ldl -lobjc "
conftest.c: In function ‘t’:
conftest.c:6: error: ‘getifaddrs’ undeclared (first use in this function)
conftest.c:6: error: (Each undeclared identifier is reported only once
conftest.c:6: error: for each function it appears in.)
checked program was:
/* begin */
1: #include "ruby.h"
2: 
3: /*top*/
4: int main() {return 0;}
5: extern int t(void);
6: int t(void) { void ((*volatile p)()); p = (void ((*)()))getifaddrs; return 0; }
/* end */

"/usr/bin/gcc-4.2 -o conftest -I../../.ext/include/x86_64-darwin12.2.0 -I../.././include -I../.././ext/socket -I../.. -I../../. -D_XOPEN_SOURCE -D_DARWIN_C_SOURCE   -I/Users/fabio/.sm/pkg/active/include -pipe conftest.c  -L. -L../.. -L. -Bstatic -L/Users/fabio/.sm/pkg/active/lib -L/usr/local/lib     -lruby-static  -lpthread -ldl -lobjc "
checked program was:
/* begin */
1: #include "ruby.h"
2: 
3: /*top*/
4: int main() {return 0;}
5: extern int t(void);
6: int t(void) { getifaddrs(); return 0; }
/* end */

--------------------

have_header: checking for sys/ioctl.h... -------------------- yes

"/usr/bin/gcc-4.2 -E -I../../.ext/include/x86_64-darwin12.2.0 -I../.././include -I../.././ext/socket -I../.. -I../../. -D_XOPEN_SOURCE -D_DARWIN_C_SOURCE   -I/Users/fabio/.sm/pkg/active/include -pipe  conftest.c -o conftest.i"
checked program was:
/* begin */
1: #include "ruby.h"
2: 
3: #include <sys/ioctl.h>
/* end */

--------------------

have_header: checking for sys/sockio.h... -------------------- yes

"/usr/bin/gcc-4.2 -E -I../../.ext/include/x86_64-darwin12.2.0 -I../.././include -I../.././ext/socket -I../.. -I../../. -D_XOPEN_SOURCE -D_DARWIN_C_SOURCE   -I/Users/fabio/.sm/pkg/active/include -pipe  conftest.c -o conftest.i"
checked program was:
/* begin */
1: #include "ruby.h"
2: 
3: #include <sys/sockio.h>
/* end */

--------------------

have_header: checking for net/if.h... -------------------- yes

"/usr/bin/gcc-4.2 -E -I../../.ext/include/x86_64-darwin12.2.0 -I../.././include -I../.././ext/socket -I../.. -I../../. -D_XOPEN_SOURCE -D_DARWIN_C_SOURCE   -I/Users/fabio/.sm/pkg/active/include -pipe  conftest.c -o conftest.i"
checked program was:
/* begin */
1: #include "ruby.h"
2: 
3: #include <sys/types.h>
4: #include <netdb.h>
5: #include <string.h>
6: #include <sys/socket.h>
7: #include <netinet/in.h>
8: #include <arpa/inet.h>
9: #include <net/if.h>
/* end */

--------------------

have_header: checking for sys/param.h... -------------------- yes

"/usr/bin/gcc-4.2 -E -I../../.ext/include/x86_64-darwin12.2.0 -I../.././include -I../.././ext/socket -I../.. -I../../. -D_XOPEN_SOURCE -D_DARWIN_C_SOURCE   -I/Users/fabio/.sm/pkg/active/include -pipe  conftest.c -o conftest.i"
checked program was:
/* begin */
1: #include "ruby.h"
2: 
3: #include <sys/types.h>
4: #include <netdb.h>
5: #include <string.h>
6: #include <sys/socket.h>
7: #include <netinet/in.h>
8: #include <arpa/inet.h>
9: #include <sys/param.h>
/* end */

--------------------

have_header: checking for sys/ucred.h... -------------------- yes

"/usr/bin/gcc-4.2 -E -I../../.ext/include/x86_64-darwin12.2.0 -I../.././include -I../.././ext/socket -I../.. -I../../. -D_XOPEN_SOURCE -D_DARWIN_C_SOURCE   -I/Users/fabio/.sm/pkg/active/include -pipe  conftest.c -o conftest.i"
checked program was:
/* begin */
1: #include "ruby.h"
2: 
3: #include <sys/types.h>
4: #include <netdb.h>
5: #include <string.h>
6: #include <sys/socket.h>
7: #include <netinet/in.h>
8: #include <arpa/inet.h>
9: #include <sys/ucred.h>
/* end */

--------------------

have_type: checking for socklen_t in sys/types.h,netdb.h,string.h,sys/socket.h,netinet/in.h,arpa/inet.h... -------------------- yes

"/usr/bin/gcc-4.2 -I../../.ext/include/x86_64-darwin12.2.0 -I../.././include -I../.././ext/socket -I../.. -I../../. -D_XOPEN_SOURCE -D_DARWIN_C_SOURCE   -I/Users/fabio/.sm/pkg/active/include -pipe   -c conftest.c"
checked program was:
/* begin */
 1: #include "ruby.h"
 2: 
 3: #include <sys/types.h>
 4: #include <netdb.h>
 5: #include <string.h>
 6: #include <sys/socket.h>
 7: #include <netinet/in.h>
 8: #include <arpa/inet.h>
 9: 
10: /*top*/
11: typedef socklen_t conftest_type;
12: int conftestval[sizeof(conftest_type)?1:-1];
/* end */

--------------------

have_header: checking for sys/un.h... -------------------- yes

"/usr/bin/gcc-4.2 -E -I../../.ext/include/x86_64-darwin12.2.0 -I../.././include -I../.././ext/socket -I../.. -I../../. -D_XOPEN_SOURCE -D_DARWIN_C_SOURCE   -I/Users/fabio/.sm/pkg/active/include -pipe  conftest.c -o conftest.i"
checked program was:
/* begin */
1: #include "ruby.h"
2: 
3: #include <sys/un.h>
/* end */

--------------------

have_header: checking for sys/uio.h... -------------------- yes

"/usr/bin/gcc-4.2 -E -I../../.ext/include/x86_64-darwin12.2.0 -I../.././include -I../.././ext/socket -I../.. -I../../. -D_XOPEN_SOURCE -D_DARWIN_C_SOURCE   -I/Users/fabio/.sm/pkg/active/include -pipe  conftest.c -o conftest.i"
checked program was:
/* begin */
1: #include "ruby.h"
2: 
3: #include <sys/uio.h>
/* end */

--------------------

have_type: checking for struct in_pktinfo in sys/types.h,netdb.h,string.h,sys/socket.h,netinet/in.h,arpa/inet.h... -------------------- yes

"/usr/bin/gcc-4.2 -I../../.ext/include/x86_64-darwin12.2.0 -I../.././include -I../.././ext/socket -I../.. -I../../. -D_XOPEN_SOURCE -D_DARWIN_C_SOURCE   -I/Users/fabio/.sm/pkg/active/include -pipe   -c conftest.c"
checked program was:
/* begin */
 1: #include "ruby.h"
 2: 
 3: #include <sys/types.h>
 4: #include <netdb.h>
 5: #include <string.h>
 6: #include <sys/socket.h>
 7: #include <netinet/in.h>
 8: #include <arpa/inet.h>
 9: 
10: #if defined(IPPROTO_IP) && defined(IP_PKTINFO)
11: typedef struct in_pktinfo conftest_type;
12: int conftestval[sizeof(conftest_type)?1:-1];
13: #else
14: #error
15: >>>>>> no in_pktinfo <<<<<<
16: #endif
/* end */

--------------------

have_struct_member: checking for struct in_pktinfo.ipi_spec_dst in sys/types.h,netdb.h,string.h,sys/socket.h,netinet/in.h,arpa/inet.h... -------------------- yes

"/usr/bin/gcc-4.2 -I../../.ext/include/x86_64-darwin12.2.0 -I../.././include -I../.././ext/socket -I../.. -I../../. -D_XOPEN_SOURCE -D_DARWIN_C_SOURCE   -I/Users/fabio/.sm/pkg/active/include -pipe   -c conftest.c"
checked program was:
/* begin */
 1: #include "ruby.h"
 2: 
 3: #include <sys/types.h>
 4: #include <netdb.h>
 5: #include <string.h>
 6: #include <sys/socket.h>
 7: #include <netinet/in.h>
 8: #include <arpa/inet.h>
 9: 
10: /*top*/
11: int main() {return 0;}
12: int s = (char *)&((struct in_pktinfo*)0)->ipi_spec_dst - (char *)0;
/* end */

--------------------

have_type: checking for struct in6_pktinfo in sys/types.h,netdb.h,string.h,sys/socket.h,netinet/in.h,arpa/inet.h... -------------------- no

"/usr/bin/gcc-4.2 -I../../.ext/include/x86_64-darwin12.2.0 -I../.././include -I../.././ext/socket -I../.. -I../../. -D_XOPEN_SOURCE -D_DARWIN_C_SOURCE   -I/Users/fabio/.sm/pkg/active/include -pipe   -c conftest.c"
conftest.c:14:2: error: #error 
conftest.c:15: error: expected identifier or ‘(’ before ‘>>’ token
checked program was:
/* begin */
 1: #include "ruby.h"
 2: 
 3: #include <sys/types.h>
 4: #include <netdb.h>
 5: #include <string.h>
 6: #include <sys/socket.h>
 7: #include <netinet/in.h>
 8: #include <arpa/inet.h>
 9: 
10: #if defined(IPPROTO_IPV6) && defined(IPV6_PKTINFO)
11: typedef struct in6_pktinfo conftest_type;
12: int conftestval[sizeof(conftest_type)?1:-1];
13: #else
14: #error
15: >>>>>> no in6_pktinfo <<<<<<
16: #endif
/* end */

--------------------

have_type: checking for struct sockcred in sys/types.h,netdb.h,string.h,sys/socket.h,netinet/in.h,arpa/inet.h... -------------------- no

"/usr/bin/gcc-4.2 -I../../.ext/include/x86_64-darwin12.2.0 -I../.././include -I../.././ext/socket -I../.. -I../../. -D_XOPEN_SOURCE -D_DARWIN_C_SOURCE   -I/Users/fabio/.sm/pkg/active/include -pipe   -c conftest.c"
conftest.c:12: error: invalid application of ‘sizeof’ to incomplete type ‘conftest_type’ 
conftest.c:12: error: size of array ‘conftestval’ is negative
checked program was:
/* begin */
 1: #include "ruby.h"
 2: 
 3: #include <sys/types.h>
 4: #include <netdb.h>
 5: #include <string.h>
 6: #include <sys/socket.h>
 7: #include <netinet/in.h>
 8: #include <arpa/inet.h>
 9: 
10: /*top*/
11: typedef struct sockcred conftest_type;
12: int conftestval[sizeof(conftest_type)?1:-1];
/* end */

--------------------

have_type: checking for struct cmsgcred in sys/types.h,netdb.h,string.h,sys/socket.h,netinet/in.h,arpa/inet.h... -------------------- no

"/usr/bin/gcc-4.2 -I../../.ext/include/x86_64-darwin12.2.0 -I../.././include -I../.././ext/socket -I../.. -I../../. -D_XOPEN_SOURCE -D_DARWIN_C_SOURCE   -I/Users/fabio/.sm/pkg/active/include -pipe   -c conftest.c"
conftest.c:12: error: invalid application of ‘sizeof’ to incomplete type ‘conftest_type’ 
conftest.c:12: error: size of array ‘conftestval’ is negative
checked program was:
/* begin */
 1: #include "ruby.h"
 2: 
 3: #include <sys/types.h>
 4: #include <netdb.h>
 5: #include <string.h>
 6: #include <sys/socket.h>
 7: #include <netinet/in.h>
 8: #include <arpa/inet.h>
 9: 
10: /*top*/
11: typedef struct cmsgcred conftest_type;
12: int conftestval[sizeof(conftest_type)?1:-1];
/* end */

--------------------

have_func: checking for getpeereid()... -------------------- yes

"/usr/bin/gcc-4.2 -o conftest -I../../.ext/include/x86_64-darwin12.2.0 -I../.././include -I../.././ext/socket -I../.. -I../../. -D_XOPEN_SOURCE -D_DARWIN_C_SOURCE   -I/Users/fabio/.sm/pkg/active/include -pipe conftest.c  -L. -L../.. -L. -Bstatic -L/Users/fabio/.sm/pkg/active/lib -L/usr/local/lib     -lruby-static  -lpthread -ldl -lobjc "
conftest.c: In function ‘t’:
conftest.c:6: error: ‘getpeereid’ undeclared (first use in this function)
conftest.c:6: error: (Each undeclared identifier is reported only once
conftest.c:6: error: for each function it appears in.)
checked program was:
/* begin */
1: #include "ruby.h"
2: 
3: /*top*/
4: int main() {return 0;}
5: extern int t(void);
6: int t(void) { void ((*volatile p)()); p = (void ((*)()))getpeereid; return 0; }
/* end */

"/usr/bin/gcc-4.2 -o conftest -I../../.ext/include/x86_64-darwin12.2.0 -I../.././include -I../.././ext/socket -I../.. -I../../. -D_XOPEN_SOURCE -D_DARWIN_C_SOURCE   -I/Users/fabio/.sm/pkg/active/include -pipe conftest.c  -L. -L../.. -L. -Bstatic -L/Users/fabio/.sm/pkg/active/lib -L/usr/local/lib     -lruby-static  -lpthread -ldl -lobjc "
checked program was:
/* begin */
1: #include "ruby.h"
2: 
3: /*top*/
4: int main() {return 0;}
5: extern int t(void);
6: int t(void) { getpeereid(); return 0; }
/* end */

--------------------

have_header: checking for ucred.h... -------------------- no

"/usr/bin/gcc-4.2 -E -I../../.ext/include/x86_64-darwin12.2.0 -I../.././include -I../.././ext/socket -I../.. -I../../. -D_XOPEN_SOURCE -D_DARWIN_C_SOURCE   -I/Users/fabio/.sm/pkg/active/include -pipe  conftest.c -o conftest.i"
conftest.c:9:19: error: ucred.h: No such file or directory
checked program was:
/* begin */
1: #include "ruby.h"
2: 
3: #include <sys/types.h>
4: #include <netdb.h>
5: #include <string.h>
6: #include <sys/socket.h>
7: #include <netinet/in.h>
8: #include <arpa/inet.h>
9: #include <ucred.h>
/* end */

--------------------

have_func: checking for getpeerucred()... -------------------- no

"/usr/bin/gcc-4.2 -o conftest -I../../.ext/include/x86_64-darwin12.2.0 -I../.././include -I../.././ext/socket -I../.. -I../../. -D_XOPEN_SOURCE -D_DARWIN_C_SOURCE   -I/Users/fabio/.sm/pkg/active/include -pipe conftest.c  -L. -L../.. -L. -Bstatic -L/Users/fabio/.sm/pkg/active/lib -L/usr/local/lib     -lruby-static  -lpthread -ldl -lobjc "
conftest.c: In function ‘t’:
conftest.c:6: error: ‘getpeerucred’ undeclared (first use in this function)
conftest.c:6: error: (Each undeclared identifier is reported only once
conftest.c:6: error: for each function it appears in.)
checked program was:
/* begin */
1: #include "ruby.h"
2: 
3: /*top*/
4: int main() {return 0;}
5: extern int t(void);
6: int t(void) { void ((*volatile p)()); p = (void ((*)()))getpeerucred; return 0; }
/* end */

"/usr/bin/gcc-4.2 -o conftest -I../../.ext/include/x86_64-darwin12.2.0 -I../.././include -I../.././ext/socket -I../.. -I../../. -D_XOPEN_SOURCE -D_DARWIN_C_SOURCE   -I/Users/fabio/.sm/pkg/active/include -pipe conftest.c  -L. -L../.. -L. -Bstatic -L/Users/fabio/.sm/pkg/active/lib -L/usr/local/lib     -lruby-static  -lpthread -ldl -lobjc "
Undefined symbols for architecture x86_64:
  "_getpeerucred", referenced from:
      _t in ccquOxZB.o
ld: symbol(s) not found for architecture x86_64
collect2: ld returned 1 exit status
checked program was:
/* begin */
1: #include "ruby.h"
2: 
3: /*top*/
4: int main() {return 0;}
5: extern int t(void);
6: int t(void) { getpeerucred(); return 0; }
/* end */

--------------------

have_func: checking for if_indextoname()... -------------------- yes

"/usr/bin/gcc-4.2 -o conftest -I../../.ext/include/x86_64-darwin12.2.0 -I../.././include -I../.././ext/socket -I../.. -I../../. -D_XOPEN_SOURCE -D_DARWIN_C_SOURCE   -I/Users/fabio/.sm/pkg/active/include -pipe conftest.c  -L. -L../.. -L. -Bstatic -L/Users/fabio/.sm/pkg/active/lib -L/usr/local/lib     -lruby-static  -lpthread -ldl -lobjc "
conftest.c: In function ‘t’:
conftest.c:6: error: ‘if_indextoname’ undeclared (first use in this function)
conftest.c:6: error: (Each undeclared identifier is reported only once
conftest.c:6: error: for each function it appears in.)
checked program was:
/* begin */
1: #include "ruby.h"
2: 
3: /*top*/
4: int main() {return 0;}
5: extern int t(void);
6: int t(void) { void ((*volatile p)()); p = (void ((*)()))if_indextoname; return 0; }
/* end */

"/usr/bin/gcc-4.2 -o conftest -I../../.ext/include/x86_64-darwin12.2.0 -I../.././include -I../.././ext/socket -I../.. -I../../. -D_XOPEN_SOURCE -D_DARWIN_C_SOURCE   -I/Users/fabio/.sm/pkg/active/include -pipe conftest.c  -L. -L../.. -L. -Bstatic -L/Users/fabio/.sm/pkg/active/lib -L/usr/local/lib     -lruby-static  -lpthread -ldl -lobjc "
checked program was:
/* begin */
1: #include "ruby.h"
2: 
3: /*top*/
4: int main() {return 0;}
5: extern int t(void);
6: int t(void) { if_indextoname(); return 0; }
/* end */

--------------------

have_type: checking for struct ip_mreq in sys/types.h,netdb.h,string.h,sys/socket.h,netinet/in.h,arpa/inet.h... -------------------- yes

"/usr/bin/gcc-4.2 -I../../.ext/include/x86_64-darwin12.2.0 -I../.././include -I../.././ext/socket -I../.. -I../../. -D_XOPEN_SOURCE -D_DARWIN_C_SOURCE   -I/Users/fabio/.sm/pkg/active/include -pipe   -c conftest.c"
checked program was:
/* begin */
 1: #include "ruby.h"
 2: 
 3: #include <sys/types.h>
 4: #include <netdb.h>
 5: #include <string.h>
 6: #include <sys/socket.h>
 7: #include <netinet/in.h>
 8: #include <arpa/inet.h>
 9: 
10: /*top*/
11: typedef struct ip_mreq conftest_type;
12: int conftestval[sizeof(conftest_type)?1:-1];
/* end */

--------------------

have_type: checking for struct ip_mreqn in sys/types.h,netdb.h,string.h,sys/socket.h,netinet/in.h,arpa/inet.h... -------------------- yes

"/usr/bin/gcc-4.2 -I../../.ext/include/x86_64-darwin12.2.0 -I../.././include -I../.././ext/socket -I../.. -I../../. -D_XOPEN_SOURCE -D_DARWIN_C_SOURCE   -I/Users/fabio/.sm/pkg/active/include -pipe   -c conftest.c"
checked program was:
/* begin */
 1: #include "ruby.h"
 2: 
 3: #include <sys/types.h>
 4: #include <netdb.h>
 5: #include <string.h>
 6: #include <sys/socket.h>
 7: #include <netinet/in.h>
 8: #include <arpa/inet.h>
 9: 
10: /*top*/
11: typedef struct ip_mreqn conftest_type;
12: int conftestval[sizeof(conftest_type)?1:-1];
/* end */

--------------------

have_type: checking for struct ipv6_mreq in sys/types.h,netdb.h,string.h,sys/socket.h,netinet/in.h,arpa/inet.h... -------------------- yes

"/usr/bin/gcc-4.2 -I../../.ext/include/x86_64-darwin12.2.0 -I../.././include -I../.././ext/socket -I../.. -I../../. -D_XOPEN_SOURCE -D_DARWIN_C_SOURCE   -I/Users/fabio/.sm/pkg/active/include -pipe   -c conftest.c"
checked program was:
/* begin */
 1: #include "ruby.h"
 2: 
 3: #include <sys/types.h>
 4: #include <netdb.h>
 5: #include <string.h>
 6: #include <sys/socket.h>
 7: #include <netinet/in.h>
 8: #include <arpa/inet.h>
 9: 
10: /*top*/
11: typedef struct ipv6_mreq conftest_type;
12: int conftestval[sizeof(conftest_type)?1:-1];
/* end */

--------------------

have_func: checking for socket()... -------------------- yes

"/usr/bin/gcc-4.2 -o conftest -I../../.ext/include/x86_64-darwin12.2.0 -I../.././include -I../.././ext/socket -I../.. -I../../. -D_XOPEN_SOURCE -D_DARWIN_C_SOURCE   -I/Users/fabio/.sm/pkg/active/include -pipe conftest.c  -L. -L../.. -L. -Bstatic -L/Users/fabio/.sm/pkg/active/lib -L/usr/local/lib     -lruby-static  -lpthread -ldl -lobjc "
conftest.c: In function ‘t’:
conftest.c:6: error: ‘socket’ undeclared (first use in this function)
conftest.c:6: error: (Each undeclared identifier is reported only once
conftest.c:6: error: for each function it appears in.)
checked program was:
/* begin */
1: #include "ruby.h"
2: 
3: /*top*/
4: int main() {return 0;}
5: extern int t(void);
6: int t(void) { void ((*volatile p)()); p = (void ((*)()))socket; return 0; }
/* end */

"/usr/bin/gcc-4.2 -o conftest -I../../.ext/include/x86_64-darwin12.2.0 -I../.././include -I../.././ext/socket -I../.. -I../../. -D_XOPEN_SOURCE -D_DARWIN_C_SOURCE   -I/Users/fabio/.sm/pkg/active/include -pipe conftest.c  -L. -L../.. -L. -Bstatic -L/Users/fabio/.sm/pkg/active/lib -L/usr/local/lib     -lruby-static  -lpthread -ldl -lobjc "
checked program was:
/* begin */
1: #include "ruby.h"
2: 
3: /*top*/
4: int main() {return 0;}
5: extern int t(void);
6: int t(void) { socket(); return 0; }
/* end */

--------------------

have_func: checking for hsterror()... -------------------- no

"/usr/bin/gcc-4.2 -o conftest -I../../.ext/include/x86_64-darwin12.2.0 -I../.././include -I../.././ext/socket -I../.. -I../../. -D_XOPEN_SOURCE -D_DARWIN_C_SOURCE   -I/Users/fabio/.sm/pkg/active/include -pipe conftest.c  -L. -L../.. -L. -Bstatic -L/Users/fabio/.sm/pkg/active/lib -L/usr/local/lib     -lruby-static  -lpthread -ldl -lobjc "
conftest.c: In function ‘t’:
conftest.c:6: error: ‘hsterror’ undeclared (first use in this function)
conftest.c:6: error: (Each undeclared identifier is reported only once
conftest.c:6: error: for each function it appears in.)
checked program was:
/* begin */
1: #include "ruby.h"
2: 
3: /*top*/
4: int main() {return 0;}
5: extern int t(void);
6: int t(void) { void ((*volatile p)()); p = (void ((*)()))hsterror; return 0; }
/* end */

"/usr/bin/gcc-4.2 -o conftest -I../../.ext/include/x86_64-darwin12.2.0 -I../.././include -I../.././ext/socket -I../.. -I../../. -D_XOPEN_SOURCE -D_DARWIN_C_SOURCE   -I/Users/fabio/.sm/pkg/active/include -pipe conftest.c  -L. -L../.. -L. -Bstatic -L/Users/fabio/.sm/pkg/active/lib -L/usr/local/lib     -lruby-static  -lpthread -ldl -lobjc "
Undefined symbols for architecture x86_64:
  "_hsterror", referenced from:
      _t in ccBq0nDC.o
ld: symbol(s) not found for architecture x86_64
collect2: ld returned 1 exit status
checked program was:
/* begin */
1: #include "ruby.h"
2: 
3: /*top*/
4: int main() {return 0;}
5: extern int t(void);
6: int t(void) { hsterror(); return 0; }
/* end */

--------------------

have_func: checking for getipnodebyname()... -------------------- yes

"/usr/bin/gcc-4.2 -o conftest -I../../.ext/include/x86_64-darwin12.2.0 -I../.././include -I../.././ext/socket -I../.. -I../../. -D_XOPEN_SOURCE -D_DARWIN_C_SOURCE   -I/Users/fabio/.sm/pkg/active/include -pipe conftest.c  -L. -L../.. -L. -Bstatic -L/Users/fabio/.sm/pkg/active/lib -L/usr/local/lib     -lruby-static  -lpthread -ldl -lobjc "
conftest.c: In function ‘t’:
conftest.c:6: error: ‘getipnodebyname’ undeclared (first use in this function)
conftest.c:6: error: (Each undeclared identifier is reported only once
conftest.c:6: error: for each function it appears in.)
checked program was:
/* begin */
1: #include "ruby.h"
2: 
3: /*top*/
4: int main() {return 0;}
5: extern int t(void);
6: int t(void) { void ((*volatile p)()); p = (void ((*)()))getipnodebyname; return 0; }
/* end */

"/usr/bin/gcc-4.2 -o conftest -I../../.ext/include/x86_64-darwin12.2.0 -I../.././include -I../.././ext/socket -I../.. -I../../. -D_XOPEN_SOURCE -D_DARWIN_C_SOURCE   -I/Users/fabio/.sm/pkg/active/include -pipe conftest.c  -L. -L../.. -L. -Bstatic -L/Users/fabio/.sm/pkg/active/lib -L/usr/local/lib     -lruby-static  -lpthread -ldl -lobjc "
checked program was:
/* begin */
1: #include "ruby.h"
2: 
3: /*top*/
4: int main() {return 0;}
5: extern int t(void);
6: int t(void) { getipnodebyname(); return 0; }
/* end */

--------------------

have_func: checking for socketpair()... -------------------- yes

"/usr/bin/gcc-4.2 -o conftest -I../../.ext/include/x86_64-darwin12.2.0 -I../.././include -I../.././ext/socket -I../.. -I../../. -D_XOPEN_SOURCE -D_DARWIN_C_SOURCE   -I/Users/fabio/.sm/pkg/active/include -pipe conftest.c  -L. -L../.. -L. -Bstatic -L/Users/fabio/.sm/pkg/active/lib -L/usr/local/lib     -lruby-static  -lpthread -ldl -lobjc "
conftest.c: In function ‘t’:
conftest.c:6: error: ‘socketpair’ undeclared (first use in this function)
conftest.c:6: error: (Each undeclared identifier is reported only once
conftest.c:6: error: for each function it appears in.)
checked program was:
/* begin */
1: #include "ruby.h"
2: 
3: /*top*/
4: int main() {return 0;}
5: extern int t(void);
6: int t(void) { void ((*volatile p)()); p = (void ((*)()))socketpair; return 0; }
/* end */

"/usr/bin/gcc-4.2 -o conftest -I../../.ext/include/x86_64-darwin12.2.0 -I../.././include -I../.././ext/socket -I../.. -I../../. -D_XOPEN_SOURCE -D_DARWIN_C_SOURCE   -I/Users/fabio/.sm/pkg/active/include -pipe conftest.c  -L. -L../.. -L. -Bstatic -L/Users/fabio/.sm/pkg/active/lib -L/usr/local/lib     -lruby-static  -lpthread -ldl -lobjc "
checked program was:
/* begin */
1: #include "ruby.h"
2: 
3: /*top*/
4: int main() {return 0;}
5: extern int t(void);
6: int t(void) { socketpair(); return 0; }
/* end */

--------------------

have_func: checking for gethostname()... -------------------- yes

"/usr/bin/gcc-4.2 -o conftest -I../../.ext/include/x86_64-darwin12.2.0 -I../.././include -I../.././ext/socket -I../.. -I../../. -D_XOPEN_SOURCE -D_DARWIN_C_SOURCE   -I/Users/fabio/.sm/pkg/active/include -pipe conftest.c  -L. -L../.. -L. -Bstatic -L/Users/fabio/.sm/pkg/active/lib -L/usr/local/lib     -lruby-static  -lpthread -ldl -lobjc "
conftest.c: In function ‘t’:
conftest.c:6: error: ‘gethostname’ undeclared (first use in this function)
conftest.c:6: error: (Each undeclared identifier is reported only once
conftest.c:6: error: for each function it appears in.)
checked program was:
/* begin */
1: #include "ruby.h"
2: 
3: /*top*/
4: int main() {return 0;}
5: extern int t(void);
6: int t(void) { void ((*volatile p)()); p = (void ((*)()))gethostname; return 0; }
/* end */

"/usr/bin/gcc-4.2 -o conftest -I../../.ext/include/x86_64-darwin12.2.0 -I../.././include -I../.././ext/socket -I../.. -I../../. -D_XOPEN_SOURCE -D_DARWIN_C_SOURCE   -I/Users/fabio/.sm/pkg/active/include -pipe conftest.c  -L. -L../.. -L. -Bstatic -L/Users/fabio/.sm/pkg/active/lib -L/usr/local/lib     -lruby-static  -lpthread -ldl -lobjc "
checked program was:
/* begin */
1: #include "ruby.h"
2: 
3: /*top*/
4: int main() {return 0;}
5: extern int t(void);
6: int t(void) { gethostname(); return 0; }
/* end */

--------------------

extconf.h is:
/* begin */
 1: #ifndef EXTCONF_H
 2: #define EXTCONF_H
 3: #define HAVE_ARPA_INET_H 1
 4: #define ENABLE_IPV6 1
 5: #define INET6 1
 6: #define HAVE_STRUCT_SOCKADDR_IN_SIN_LEN 1
 7: #define HAVE_SIN_LEN 1
 8: #define HAVE_STRUCT_SOCKADDR_STORAGE_SS_FAMILY 1
 9: #define HAVE_SOCKADDR_STORAGE 1
10: #define HAVE_STRUCT_SOCKADDR_STORAGE_SS_LEN 1
11: #define HAVE_ST_SS_LEN 1
12: #define HAVE_STRUCT_SOCKADDR_SA_LEN 1
13: #define HAVE_SA_LEN  1
14: #define HAVE_NETINET_TCP_H 1
15: #define HAVE_NETINET_UDP_H 1
16: #define HAVE_SENDMSG 1
17: #define HAVE_RECVMSG 1
18: #define HAVE_STRUCT_MSGHDR_MSG_CONTROL 1
19: #define HAVE_ST_MSG_CONTROL 1
20: #define HAVE_TYPE_STRUCT_ADDRINFO 1
21: #define HAVE_FREEHOSTENT 1
22: #define HAVE_FREEADDRINFO 1
23: #define HAVE_GAI_STRERROR 1
24: #define GAI_STRERROR_CONST 1
25: #define HAVE_GETNAMEINFO 1
26: #define HAVE_GETADDRINFO 1
27: #define HAVE_INET_NTOP 1
28: #define HAVE_INET_PTON 1
29: #define HAVE_GETSERVBYPORT 1
30: #define HAVE_ARPA_NAMESER_H 1
31: #define HAVE_RESOLV_H 1
32: #define HAVE_IFADDRS_H 1
33: #define HAVE_GETIFADDRS 1
34: #define HAVE_SYS_IOCTL_H 1
35: #define HAVE_SYS_SOCKIO_H 1
36: #define HAVE_NET_IF_H 1
37: #define HAVE_SYS_PARAM_H 1
38: #define HAVE_SYS_UCRED_H 1
39: #define HAVE_TYPE_SOCKLEN_T 1
40: #define HAVE_SYS_UN_H 1
41: #define HAVE_SYS_UIO_H 1
42: #define HAVE_TYPE_STRUCT_IN_PKTINFO 1
43: #define HAVE_STRUCT_IN_PKTINFO_IPI_SPEC_DST 1
44: #define HAVE_ST_IPI_SPEC_DST 1
45: #define HAVE_GETPEEREID 1
46: #define HAVE_IF_INDEXTONAME 1
47: #define HAVE_TYPE_STRUCT_IP_MREQ 1
48: #define HAVE_TYPE_STRUCT_IP_MREQN 1
49: #define HAVE_TYPE_STRUCT_IPV6_MREQ 1
50: #define HAVE_SOCKET 1
51: #define HAVE_GETIPNODEBYNAME 1
52: #define HAVE_SOCKETPAIR 1
53: #define HAVE_GETHOSTNAME 1
54: #endif
/* end */

